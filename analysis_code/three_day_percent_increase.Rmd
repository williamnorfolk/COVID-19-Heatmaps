---
title: "three_day_percent_increase"
author: "William Norfolk"
date: "3/26/2020"
output: html_document
---


```{r}
library(tidyverse)
library(readr)
library(maps)
library(usmap)
library(viridis)
```

```{r}
#Load masterdata
covid_master <- readRDS("../clean_covid_data.rds")
```


```{r}
#To determine percent increase from prior day, include only last two observations
#MODIFY: object dates and variable dates.

only_21_and_24 <- subset(covid_master, select = c(Province_State, cases_3_21, cases_3_24, fips, total_pop))
```


```{r}
#add percent increase
#MODIFY: object dates and variable dates.

only_21_and_24 <- only_21_and_24 %>% dplyr::mutate(percent_increase = (cases_3_24 - cases_3_21) / cases_3_24 * 100)
```

```{r}
#make heatmap of percent increase

p_increase_cases_21_to_24 <- plot_usmap(data = only_21_and_24, values = "percent_increase", color = "black") + 
  
  scale_fill_continuous(low = "white", high = "red", name = "Percent Increase", label = scales::comma) + theme(legend.position = "right", plot.title = element_text(color = "black", size = 15, face = "bold"), plot.subtitle = element_text(color = "black", size = 10, face = "italic")) + labs(title = "Percent Increase of Confirmed COVID-19 Cases by State", subtitle = "From: 3/21/2020-3/24/2020")

p_increase_cases_21_to_24
```

```{r}
ggsave(filename = "../heat_maps/p_increase_cases_21_to_24.png", plot = p_increase_cases_21_to_24)
```


```{r}
#Take a look at the top 10 percent increases
#MODIFY: cases variable for new date
tail(sort(only_21_and_24$percent_increase ),10)
```

```{r}
#subset top 10 cases
#subset top 10 100K
#MODIFY: must search ten above individually (subset does not allow to select by these values for some reason...) and past the states in the code below.Also modify variable and object date names.

extp_1 <- subset(only_21_and_24, Province_State == "Pennsylvania")
extp_2 <- subset(only_21_and_24, Province_State == "Montana")
extp_3 <- subset(only_21_and_24, Province_State == "Hawaii")
extp_4 <- subset(only_21_and_24, Province_State == "West Virginia")
extp_5 <- subset(only_21_and_24, Province_State == "Arizona")
extp_6 <- subset(only_21_and_24, Province_State == "New Jersey")
extp_7 <- subset(only_21_and_24, Province_State == "Indiana")
extp_8 <- subset(only_21_and_24, Province_State == "Connecticut")
extp_9 <- subset(only_21_and_24, Province_State == "Vermont")
extp_10 <- subset(only_21_and_24, Province_State == "Missouri")

top_ten_perc_increase <- rbind(extp_1, extp_2, extp_3, extp_4, extp_5, extp_6, extp_7, extp_8, extp_9, extp_10)
```

```{r}
#make bar chart
#Modify: object dates and variable dates

three_day_perc_increase_3_21_to_3_24_bar <- ggplot(top_ten_perc_increase, aes(x = reorder(Province_State, -percent_increase), percent_increase)) + geom_bar(aes(fill = reorder(Province_State, -percent_increase)), stat = "identity") + theme(axis.text.x = element_text(angle = 45, hjust = 1),
                                                                                                   legend.position = "none",                                                                        axis.text=element_text(size=10),
  panel.border = element_blank(),
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  axis.line = element_line(colour = "black"),
  panel.background = element_blank()) + xlab("") + ylab("Percent Increase") + ggtitle("COVID-19: Top Ten Percent Increase by State From 3/21/2020-3/24/2020") +
  
   geom_text(aes(label = round(percent_increase, 2)), size = 4, position = position_stack(vjust = 0.8))

three_day_perc_increase_3_21_to_3_24_bar
```

```{r}
ggsave(filename = "../bar_charts/three_day_perc_increase_3_21_to_3_24_bar.png", plot = three_day_perc_increase_3_21_to_3_24_bar)
```




